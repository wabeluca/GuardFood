<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardFood - Cliente</title>
    <link href="src/css/admin.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <style>

        .item {
            width: 100%;
            margin-right: 1rem;
            padding: 1rem;
            transition: 0.25s ease-in-out;
            border-radius: 5px;
        }

        .categoria .item:hover {
            background-color: rgb(108,117,125);
            color: white;
        }

    </style>
</head>
<body>
    <div class="row h-100">
        <div class="col-12 p-3">
            <div class="bg-white h-100 p-3 d-flex flex-column">
                <div id="conteudo" class="mt-5">
                <div class="d-flex justify-content-between">
                    <span class="text-danger px-2 w-auto fs-2 fw-bold">Restaurantes</span>
                </div>
                    <div class="categoria d-flex align-items-center text-secondary justify-content-around" style="font-size: 5em;">
                        <div class="item d-flex flex-column align-items-center justify-content-center">
                            <span class="mdi mdi-food-hot-dog"></span>
                            <p class="fs-5">Cachorro quente</p>
                        </div>
                        <div class="item d-flex flex-column align-items-center justify-content-center">
                            <span class="mdi mdi-pizza"></span>
                            <p class="fs-5">Pizza</p>
                        </div>
                        <div class="item d-flex flex-column align-items-center justify-content-center">
                            <span class="mdi mdi-hamburger"></span>
                            <p class="fs-5">Hamburguer</p>
                        </div>
                        <div class="item d-flex flex-column align-items-center justify-content-center">
                            <span class="mdi mdi-fish"></span>
                            <p class="fs-5">Comida Oriental</p>
                        </div>
                        <div class="item d-flex flex-column align-items-center justify-content-center">
                            <span class="mdi mdi-food-croissant"></span>
                            <p class="fs-5">Padaria</p>
                        </div>
                        <div class="item d-flex flex-column align-items-center justify-content-center">
                            <span class="mdi mdi-food-fork-drink"></span>
                            <p class="fs-5">Fast Food</p>
                        </div>
                        <div class="item d-flex flex-column align-items-center justify-content-center">
                            <span class="mdi mdi-food-steak"></span>
                            <p class="fs-5">Comida Brasileira</p>
                        </div>
                    </div>
                    <ul id="minhaLista" class="list-unstyled">
                    </ul>
                </div>
                <div id="detalhe" class="container" style="display: none;">
                    <div id="restaurante-info">

                    </div>
                    <ul id="lista-produtos" class="list-unstyled">
                    </ul>
                    <div class="w-100 d-flex justify-content-center">
                        <button type="button" class="btn px-5 py-3 fw-semibold" data-bs-toggle="modal" data-bs-target="#meuModal">
                            Realizar pedido
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="meuModal" tabindex="-1" aria-labelledby="meuModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-success p-5" style="display: none;">
                    <div class="d-flex flex-column justify-content-center align-items-center text-success fs-1">
                        <span class="mdi mdi-check-circle text-success"></span>
                        <h6>Pedido realizado com sucesso!</h6>
                        <input type="text" id="userLocation" name="userLocation" class="form-control text-center text-success" readonly>
                        <button onclick="window.location.reload()" class="btn btn-success mt-5">OK</button>
                    </div>
                </div>
                <div class="modal-header">
                    <h5 class="modal-title" id="meuModalLabel">Finalizar pedido</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger alert-dismissible">
                        Em casos urgentes ligue no <strong>190</strong>
                    </div>
                    
                    <form>
                        <div class="mb-5">
                            <p>Finalize agora seu pedido</p>
                            <p><span class="mdi mdi-clock-fast me-1"></span>tempo de espera estimado é de <b>34-45 min</b></p>
                        </div>
                        <label class="form-label" for="denuncia">Observações do pedido</label>
                        <textarea id="descricao" placeholder="Relate oque está acontecendo sua privacidade será respeitada!" class="form-control" name="denuncia" style="height: 200px;"></textarea>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-success" onclick="enviarDenuncia()">Enviar</button>
                </div>

            </div>
            
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/@brazilian-utils/brazilian-utils/dist/brazilian-utils.cjs.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
</body>

<script>
const minhaLista = document.getElementById("minhaLista");
const detalhe = document.getElementById("detalhe");
const restauranteInfo = document.getElementById("restaurante-info");

axios.get("https://localhost:7016/restaurante/todos")
    .then(response => {
        console.log(response.data);
        response.data.forEach((item) => {
            adicionarItem(minhaLista, item);
        });
    })
    .catch(error => {
        console.error("Erro ao enviar os dados para a API:", error);
    });

// Função para criar e adicionar um item à lista
function adicionarItem(lista, item) {
const li = document.createElement("li");
li.dataset.id = item.id;
li.classList.add("p-3");
li.style.borderBottom = "2px solid #dc3545";

const div = document.createElement("div");
div.classList.add("d-flex", "justify-content-between", "align-items-center");

const divEsquerda = document.createElement("div");
divEsquerda.classList.add("w-50", "d-flex", "align-items-center");

const divTexto = document.createElement("div");
divTexto.style.marginLeft = "15px";

const img = document.createElement("img");
img.src = item.logo;
img.style.maxWidth = "75px";

const h4 = document.createElement("h4");
h4.textContent = item.nome;

const descricao = document.createElement("small");
descricao.textContent = item.descricao;

divTexto.appendChild(h4);
divTexto.appendChild(descricao);
divEsquerda.appendChild(img);
divEsquerda.appendChild(divTexto);

const divDireita = document.createElement("div");

const spanVisualizar = document.createElement("span");
spanVisualizar.classList.add("mdi", "mdi-arrow-right", "fs-3", "text-danger");
spanVisualizar.style.cursor = "pointer";
spanVisualizar.onclick = () => { abrirDetalhe(item.id) };

divDireita.appendChild(spanVisualizar);

div.appendChild(divEsquerda);
div.appendChild(divDireita);

li.appendChild(div);
lista.appendChild(li);
}
function abrirDetalhe(id) {
    axios.get("https://localhost:7016/restaurante/detalhe/" + id)
    .then(response => {
        document.getElementById("conteudo").style.display = "none";
        document.getElementById("detalhe").style.display = "";
        fillDetail(response.data);
    })
    .catch(error => {
        console.error("Erro ao enviar os dados para a API:", error);
    });
}


function headerDetail(restaurante) {
var divElement = document.createElement('div');
var botao = document.getElementById("")
divElement.classList.add('d-flex', 'py-3');

var imageDiv = document.createElement('div');
imageDiv.classList.add('me-3');

var image = document.createElement('img');
image.style.maxWidth = '75px';
image.src = restaurante.logo;

imageDiv.appendChild(image);

var textDiv = document.createElement('div');

var h1Element = document.createElement('h1');
h1Element.textContent = restaurante.nome;

var pElement = document.createElement('p');
var spanElement = document.createElement('span');
spanElement.textContent = restaurante.categoria;
pElement.appendChild(spanElement);

textDiv.appendChild(h1Element);
textDiv.appendChild(pElement);

divElement.appendChild(imageDiv);
divElement.appendChild(textDiv);

restauranteInfo.appendChild(divElement);

}
function neckDetail(restaurante) {
var divElement = document.createElement('div');
divElement.classList.add('d-flex', 'my-3');

var div1 = document.createElement('div');
div1.classList.add('p-3', 'w-auto', 'me-3', 'fw-semibold');
div1.style.borderRadius = '15px';
div1.style.backgroundColor = '#efefef';
div1.style.border = '1px solid #ddd';
div1.textContent = 'Entrega';

var div2 = document.createElement('div');
div2.classList.add('p-3', 'w-100', 'me-3');
div2.style.borderRadius = '15px';
div2.style.backgroundColor = '#efefef';
div2.style.border = '1px solid #ddd';
div2.innerHTML = '<b>Hoje,</b> 34-45 min R$ 4,99';

var div3 = document.createElement('div');
var numeroAleatorio = Math.floor(Math.random() * (500 - 10 + 1)) + 10;
div3.classList.add('p-3', 'w-100', 'me-3');
div3.style.borderRadius = '15px';
div3.style.backgroundColor = '#efefef';
div3.style.border = '1px solid #ddd';
div3.innerHTML = '<span class="mdi mdi-star">4,8 ('+ numeroAleatorio + ')</span>';

var div4 = document.createElement('div');
div4.classList.add('p-3', 'w-100', 'fw-semibold');
div4.style.borderRadius = '15px';
div4.style.backgroundColor = '#efefef';
div4.style.border = '1px solid #ddd';
div4.textContent = 'Muito elogiado';

divElement.appendChild(div1);
divElement.appendChild(div2);
divElement.appendChild(div3);
divElement.appendChild(div4);

restauranteInfo.appendChild(divElement);
}
function bodyDetail(produto) {
  const lista = document.getElementById("lista-produtos");
  var li = document.createElement("li");
  li.style.borderBottom = ".25px solid #efefef";
  li.style.padding = "1rem 0";

  var divPrincipal = document.createElement("div");
  divPrincipal.classList.add("d-flex", "justify-content-between", "align-items-center");

  var divEsquerda = document.createElement("div");
  var divDescricao = document.createElement("div");
  divDescricao.classList.add("w-auto");
  var pNome = document.createElement("p");
  pNome.textContent = produto.nome;
  var pDescricao = document.createElement("p");
  pDescricao.textContent = produto.descricao;
  pDescricao.classList.add("text-secondary");
  var spanPreco = document.createElement("span");
  spanPreco.textContent = produto.valorMonetario;

  divDescricao.appendChild(pNome);
  divDescricao.appendChild(pDescricao);
  divDescricao.appendChild(spanPreco);
  divEsquerda.appendChild(divDescricao);

  var divDireita = document.createElement("div");
  divDireita.classList.add("ms-5");
  divDireita.style.width = "100px";
  var spanIcone = document.createElement("span");
  spanIcone.classList.add("mdi", "mdi-food", "fs-1");

  divDireita.appendChild(spanIcone);

  divPrincipal.appendChild(divEsquerda);
  divPrincipal.appendChild(divDireita);

  li.appendChild(divPrincipal);
  lista.appendChild(li);
 }
async function fillDetail(data) {
    await headerDetail(data.restaurante);
    await neckDetail(data.restaurante);
    data.produtos.forEach(item => bodyDetail(item));
}

async function enviarDenuncia()
{
    await obterLocalizacao();
    const descricao = document.getElementById("descricao").value;
    const location = locationText;
    const formData = new FormData();
    formData.append("descricao", descricao);
    formData.append("localizacao", location);

    axios.post("https://localhost:7016/pedido/inserir", formData)
        .then(response => {
            document.querySelector(".modal-header").style.display = "none";
            document.querySelector(".modal-body").style.display = "none";
            document.querySelector(".modal-footer").style.display = "none";
            document.querySelector(".modal-success").style.display = "";
            console.log(response.data);
        })
        .catch(error => {
            alert("Ocorreu algum erro com a API");
            console.error("Erro ao enviar os dados para a API:", error);
        });
}
let locationText = "";
function obterLocalizacao() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    locationText = `Latitude: ${latitude}, Longitude: ${longitude}`;

                    document.getElementById("userLocation").value = locationText;
                });
            } else {
                alert("Geolocalização não é suportada pelo seu navegador.");
            }
        }

</script>

</html>